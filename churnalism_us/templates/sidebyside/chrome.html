{% extends "base.html" %}

{% load jsonify %}
{% load trailingslash %}
{% block title %}Churnalism - Side by Side View {% endblock %}

{% comment %}
This template stands alone because the chrome extension performs a POST request
and then dynamically injects the result into a source-less iframe. This causes
relative links inside the injected iframe to be relative to the containing page,
so all links output must be absolute.
{% endcomment %}

    {% block head %}
        <style type="text/css">
            iframe, html, body { padding: 0; margin: 0; }
            ul { margin: 0; padding-top: 0; padding-bottom: 0; }
            body {
                background-color: #fbf8f3; 
                font-family: Georgia,Times New Roman,Times,serif;
            }
            #explain-bar {
                background: none #f9f6ed;
                border-bottom: 1px solid #363671;
                font-family: Helvetica,Arial,sans-serif;
                padding: 1em;
            }
            #explain {
                margin: 0 0 1em 0;
                width: 85%;
            }
            #sidebysideHeader { 
                margin-top: 15px;
                margin-bottom: 40px;
            }
            #match-bar {
                font-family: Helvetica,Arial,sans-serif;
                font-size: 2.8em;
                font-weight: bold;
                float: right;
            }
            #sidebysideHeader a { float: left; font-size: 110%; margin-top: 13px; }
            span#overlap-label {
                position: relative;
                float: right;
                line-height: 30px;
            }
            .link-separator {
                letter-spacing: 117%;
                font-weight: bold;
            }
            h1 {
                font-size: 120%;
            }
            #sidebyside-title-box {
                width: 100%;
                max-height: 25%;
            }
            #sidebyside-box {
                width: 100%;
            }
            #doc-title-box, #pr-title-box {
                -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */
                -moz-box-sizing: border-box;    /* Firefox, other Gecko */
                box-sizing: border-box;         /* Opera/IE 8+ */
                float: left;
                width: 46%;
                margin: 0;
            }
            #pr-title, #doc-title { font-size: 1.8em; }
            #doc-box, #pr-box {
                -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */
                -moz-box-sizing: border-box;    /* Firefox, other Gecko */
                box-sizing: border-box;         /* Opera/IE 8+ */
                float: left;
                width: 46%;
                height: 100%;
                margin: 0;
            }
            #doc-box, #doc-title-box { padding: 0 4% 0 0; }
            #pr-box, #pr-title-box { padding: 0 0 0 4%; }
            #doc-text, #pr-text {
            }
            .churnalism-highlight {
                background-color: #F6F93A;
                padding: 0;
                margin: 0;
                font-style: italic;
                cursor: pointer;
                z-index: 99997;
            }
            span.churnalism-highlight-pair {
                background-color: #E7CC29;
                z-index: 99998;
            }
            span.churnalism-highlight-selected {
                background-color: #FF73CE;
                color: #FFFAFA;
                z-index: 99999;
                -moz-user-select: none; // mozilla browsers
                -khtml-user-select: none; // webkit browsers
            }
            .clear {
                clear: both;
            }
        #container { border-top: 1px solid #E5E1DD; } 
        #share { display: none; }
        svg#fragment-connector {
            z-index: 999999;
            padding: 0;
            margin: 0;
            border-width: 0;
        }
        #bezier {
            stroke-dasharray: 6 3;
            stroke: #FF73CE;
        }
        </style>
        <title>{% firstof source_title match_title "Search Results" %}</title>
    {% endblock %}

    {% block overlap %}
    <div id="sidebysideHeader">
        <a href="{% url sidebyside-permalink uuid match.doctype match.docid %}">Â« Back to all Matches</a>
        <div id="match-bar">
            <span id="overlap-label">Overlap: {{ match.coverage.1|floatformat:0 }}%</span>
        </div>
        <div class="clear"></div>
    </div>
    {% endblock %}

    {% block body %}
        <div style="position: relative;">

            <div id="sidebyside-title-box">
                <div id="doc-title-box">
                    <h2 class="withTip" id="doc-title">
                        {% ifequal source_title None %}
                            Pasted Text
                        {% else %}
                            {{ source_title }}
                        {% endifequal %}
                    </h2>
                </div>
                <div id="pr-title-box">
                    <h2 class="withTip" id="pr-title">
                        {{ match_title }}
                    </h2>
                    <em>Source: {{match_source}}</em>
                </div>
                <div class="clear">
                </div>
            </div>
            <div id="sidebyside-box">
                <div id="doc-box">
                    <div id="doc-text">
                        {{ source_text }}
                    </div>
                </div>
                <div id="pr-box">
                    <div id="pr-text">
                        {{ match_text }}
                    </div>
                </div>
                <div class="clear">
                </div>
            </div>
            <div id="footer">
            </div>
        </div>
        {% endblock %}
{% block js %}
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>
        <script type="text/javascript" src="{{ ABSOLUTE_STATIC_URL }}scripts/jquery.scrollintoview.min.js"></script>
        <script type="text/javascript" src="{{ ABSOLUTE_STATIC_URL }}scripts/highlight.js"></script>
        <script type="text/javascript" src="{{ ABSOLUTE_STATIC_URL }}scripts/sidebyside_common.js"></script>
        <script type="text/javascript" src="{{ ABSOLUTE_STATIC_URL }}scripts/sidebyside_sidebyside.js"></script>
        <script type="text/x-jquery-template" id="connector-tmpl">
            <svg id="fragment-connector" pointer-events="none">
                <path id="bezier" stroke-width="3" fill="none"/>
                <g stroke="none" stroke-width="3" fill="none">
                    <circle id="A" r="3" />
                    <circle id="B" r="3" />
                    <circle id="C" r="3" />
                    <circle id="D" r="3" />
                    <circle id="E" r="3" />
                </g>
            </svg>
        </script>
        <script type="text/javascript">
            var search_results = {{ results|jsonify|safe }};
        </script>
{% endblock %}        

